<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test View Toggle - Contact Management System</title>
    <link rel="stylesheet" href="style.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .test-header {
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .test-status {
            background: #e8f4fd;
            border: 1px solid #bee5eb;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        
        .view-controls {
            margin-bottom: 20px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 4px;
        }
        
        .view-toggle-buttons {
            display: flex;
            gap: 10px;
        }
        
        .view-btn {
            padding: 8px 16px;
            border: 2px solid #007bff;
            background: white;
            color: #007bff;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .view-btn.active {
            background: #007bff;
            color: white;
        }
        
        .view-btn:hover {
            background: #0056b3;
            color: white;
        }
        
        /* Override main-content to show only contact list for testing */
        .main-content {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            height: 400px;
        }
        
        .contact-list {
            border: 1px solid #ddd;
            border-radius: 4px;
            overflow-y: auto;
            background: white;
        }
        
        /* Ensure list view styles are visible */
        .contact-list.list-view .contact-list-item {
            display: flex !important;
            justify-content: space-between !important;
            align-items: center !important;
            padding: 8px 16px !important;
            height: 36px !important;
            border-bottom: 1px solid #eee !important;
            font-size: 0.875rem !important;
        }
        
        .contact-list.list-view .contact-list-item:hover {
            background-color: #f8f9fa !important;
        }
        
        .contact-list.list-view .contact-list-item.selected {
            background-color: #e3f2fd !important;
            border-left: 3px solid #2196f3 !important;
        }
        
        .contact-list.list-view .contact-list-item .contact-name {
            flex: 1 !important;
            font-weight: 400 !important;
            margin: 0 !important;
        }
        
        .contact-list.list-view .contact-list-item .contact-actions {
            opacity: 0 !important;
            transition: opacity 0.2s ease !important;
        }
        
        .contact-list.list-view .contact-list-item:hover .contact-actions {
            opacity: 1 !important;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1>View Toggle Test</h1>
            <p>Testing card view and list view toggle functionality</p>
        </div>
        
        <div class="test-status" id="status">
            Loading application...
        </div>
        
        <div class="view-controls">
            <h3>View Mode Controls</h3>
            <div class="view-toggle-buttons">
                <button id="view-card" class="view-btn active">
                    <i class="icon-grid"></i> Card View
                </button>
                <button id="view-list" class="view-btn">
                    <i class="icon-list"></i> List View
                </button>
            </div>
            <p><strong>Current View Mode:</strong> <span id="current-view-mode">card</span></p>
            <div style="font-size: 0.875rem; color: #666; margin-top: 10px;">
                <strong>Card View:</strong> Shows detailed contact cards with all information<br>
                <strong>List View:</strong> Shows only contact names in compact, low-height rows
            </div>
        </div>
        
        <!-- Contact Management Interface -->
        <div class="main-content">
            <div class="contact-list card-view" id="contact-list">
                <!-- Contacts will be rendered here -->
            </div>
        </div>
        
        <!-- Test Controls -->
        <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 4px;">
            <h3>Test Actions</h3>
            <button onclick="createTestContacts()" style="margin-right: 10px; padding: 8px 16px;">
                Create Test Contacts
            </button>
            <button onclick="toggleView()" style="margin-right: 10px; padding: 8px 16px;">
                Toggle View
            </button>
            <button onclick="checkViewState()" style="padding: 8px 16px;">
                Check View State
            </button>
        </div>
        
        <!-- Results -->
        <div id="results" style="margin-top: 20px; padding: 15px; background: #f1f3f4; border-radius: 4px;">
            <h3>Test Results</h3>
            <div id="test-output">No tests run yet.</div>
        </div>
    </div>

    <!-- Application Scripts -->
    <script src="lib/userbase.js"></script>
    <script src="src/utils/EventBus.js"></script>
    <script src="src/core/VCardStandard.js"></script>
    <script src="src/core/ContactValidator.js"></script>
    <script src="src/core/ContactDatabase.js"></script>
    <script src="src/core/ContactManager.js"></script>
    <script src="src/ui/ContactUIController.js"></script>
    <script src="src/config/app.config.js"></script>
    <script src="src/app.js"></script>

    <script>
        let app;
        let testContactIds = [];
        
        // Initialize app when DOM is loaded
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                console.log('🧪 Initializing test application...');
                
                // Create EventBus and components
                const eventBus = new EventBus();
                const database = new ContactDatabase(eventBus);
                const contactManager = new ContactManager(eventBus, database);
                const uiController = new ContactUIController(eventBus, contactManager);
                
                // Initialize the UI controller
                await uiController.initialize();
                
                app = {
                    eventBus,
                    database,
                    contactManager,
                    uiController
                };
                
                document.getElementById('status').innerHTML = '✅ Application initialized successfully!';
                console.log('✅ Test app initialized');
                
                // Set up view toggle listeners
                setupViewToggleListeners();
                
            } catch (error) {
                console.error('❌ Test initialization failed:', error);
                document.getElementById('status').innerHTML = `❌ Initialization failed: ${error.message}`;
            }
        });
        
        function setupViewToggleListeners() {
            const cardBtn = document.getElementById('view-card');
            const listBtn = document.getElementById('view-list');
            
            cardBtn.addEventListener('click', () => {
                app.uiController.setViewMode('card');
                updateViewButtons('card');
                document.getElementById('current-view-mode').textContent = 'card';
            });
            
            listBtn.addEventListener('click', () => {
                app.uiController.setViewMode('list');
                updateViewButtons('list');
                document.getElementById('current-view-mode').textContent = 'list';
            });
        }
        
        function updateViewButtons(activeView) {
            const cardBtn = document.getElementById('view-card');
            const listBtn = document.getElementById('view-list');
            
            cardBtn.classList.toggle('active', activeView === 'card');
            listBtn.classList.toggle('active', activeView === 'list');
        }
        
        async function createTestContacts() {
            if (!app) {
                alert('App not initialized yet!');
                return;
            }
            
            try {
                const testContacts = [
                    {
                        fn: 'John Doe',
                        cardName: 'John Doe - Work',
                        phones: [{ value: '+1-555-123-4567', type: 'work' }],
                        emails: [{ value: 'john@company.com', type: 'work' }],
                        organization: 'Tech Corp',
                        title: 'Software Developer'
                    },
                    {
                        fn: 'Jane Smith',
                        cardName: 'Jane Smith - Personal',
                        phones: [{ value: '+1-555-987-6543', type: 'mobile' }],
                        emails: [{ value: 'jane@email.com', type: 'personal' }]
                    },
                    {
                        fn: 'Bob Johnson',
                        cardName: 'Bob Johnson - Client',
                        phones: [
                            { value: '+1-555-111-2222', type: 'work' },
                            { value: '+1-555-333-4444', type: 'mobile' }
                        ],
                        emails: [{ value: 'bob@client.com', type: 'work' }],
                        organization: 'Client Company'
                    }
                ];
                
                testContactIds = [];
                for (const contactData of testContacts) {
                    const result = await app.contactManager.createContact(contactData);
                    if (result.success) {
                        testContactIds.push(result.contact.contactId);
                    }
                }
                
                logResult(`✅ Created ${testContactIds.length} test contacts`);
                
                // Refresh the contact list
                await app.uiController.loadContacts();
                
            } catch (error) {
                logResult(`❌ Failed to create test contacts: ${error.message}`);
            }
        }
        
        function toggleView() {
            if (!app) {
                alert('App not initialized yet!');
                return;
            }
            
            const currentMode = app.uiController.viewMode;
            const newMode = currentMode === 'card' ? 'list' : 'card';
            
            app.uiController.setViewMode(newMode);
            updateViewButtons(newMode);
            document.getElementById('current-view-mode').textContent = newMode;
            
            logResult(`🔄 Switched from ${currentMode} to ${newMode} view`);
        }
        
        function checkViewState() {
            if (!app) {
                alert('App not initialized yet!');
                return;
            }
            
            const contactList = document.getElementById('contact-list');
            const currentMode = app.uiController.viewMode;
            const hasCardClass = contactList.classList.contains('card-view');
            const hasListClass = contactList.classList.contains('list-view');
            
            const cardItems = contactList.querySelectorAll('.contact-card');
            const listItems = contactList.querySelectorAll('.contact-list-item');
            
            let result = `📊 View State Check:\n`;
            result += `- Current view mode: ${currentMode}\n`;
            result += `- Container has card-view class: ${hasCardClass}\n`;
            result += `- Container has list-view class: ${hasListClass}\n`;
            result += `- Number of card items: ${cardItems.length}\n`;
            result += `- Number of list items: ${listItems.length}\n`;
            
            // Check if the correct items are visible
            const expectedItemType = currentMode === 'card' ? 'contact-card' : 'contact-list-item';
            const actualItems = contactList.querySelectorAll(`.${expectedItemType}`);
            result += `- Expected ${expectedItemType} items: ${actualItems.length}\n`;
            
            logResult(result);
        }
        
        function logResult(message) {
            const output = document.getElementById('test-output');
            const timestamp = new Date().toLocaleTimeString();
            output.innerHTML += `<div style="margin: 5px 0; padding: 5px; background: white; border-radius: 3px;">[${timestamp}] ${message}</div>`;
            output.scrollTop = output.scrollHeight;
        }
    </script>
</body>
</html>