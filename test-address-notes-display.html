<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Address & Notes Display</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h1>Test Address & Notes Display</h1>
        
        <div class="test-section">
            <h2>Create Test Contact with Address & Notes</h2>
            <button id="create-test-contact">Create Test Contact</button>
            <div id="test-result"></div>
        </div>

        <div class="test-section">
            <h2>Display Test Contact</h2>
            <button id="display-test-contact">Display Contact Details</button>
            <div id="display-result"></div>
        </div>
    </div>

    <script type="module">
        import { VCardStandard } from './src/core/VCardStandard.js';
        
        const vCardStandard = new VCardStandard();
        let testContact = null;

        document.getElementById('create-test-contact').addEventListener('click', () => {
            console.log('🧪 Creating test contact with address and notes...');
            
            const testFormData = {
                fullName: 'Alice Test',
                cardName: 'Test Contact',
                organization: 'Test Company',
                title: 'Test Manager',
                phones: [
                    { value: '+1-555-123-4567', type: 'work', primary: true },
                    { value: '+1-555-987-6543', type: 'mobile', primary: false }
                ],
                emails: [
                    { value: 'alice@testcompany.com', type: 'work', primary: true }
                ],
                urls: [
                    { value: 'https://testcompany.com', type: 'work', primary: true }
                ],
                addresses: [
                    {
                        street: '123 Main Street',
                        city: 'Springfield',
                        state: 'IL',
                        postalCode: '62701',
                        country: 'USA',
                        type: 'work',
                        primary: true
                    },
                    {
                        street: '456 Oak Avenue',
                        city: 'Springfield',
                        state: 'IL',
                        postalCode: '62702',
                        country: 'USA',
                        type: 'home',
                        primary: false
                    }
                ],
                notes: [
                    'This is the first test note with important information.',
                    'This is a second note for testing multiple notes.'
                ]
            };

            // Generate vCard from form data
            const vCardString = vCardStandard.generateVCard(testFormData);
            console.log('📄 Generated vCard:', vCardString);

            // Create contact object
            testContact = {
                contactId: 'test-contact-123',
                cardName: testFormData.cardName,
                vcard: vCardString,
                metadata: {
                    createdAt: new Date().toISOString(),
                    lastUpdated: new Date().toISOString(),
                    isOwned: true,
                    isArchived: false
                }
            };

            console.log('👤 Created test contact:', testContact);
            
            document.getElementById('test-result').innerHTML = `
                <h3>Generated vCard:</h3>
                <pre>${vCardString}</pre>
                <h3>Contact Object:</h3>
                <pre>${JSON.stringify(testContact, null, 2)}</pre>
            `;
        });

        document.getElementById('display-test-contact').addEventListener('click', () => {
            if (!testContact) {
                alert('Please create a test contact first');
                return;
            }

            console.log('🔍 Extracting display data from test contact...');
            
            // Extract display data
            const displayData = vCardStandard.extractDisplayData(testContact);
            console.log('📊 Display data:', displayData);

            // Test the UI rendering methods
            const renderContactFields = (displayData) => {
                let html = '';
                
                // Phone numbers
                if (displayData.phones && displayData.phones.length > 0) {
                    html += `
                        <div class="field-group">
                            <h4><i class="fas fa-phone"></i> Phone Numbers</h4>
                            ${displayData.phones.map(phone => `
                                <div class="field-item">
                                    <span class="field-value">${phone.value}</span>
                                    <span class="field-type">${phone.type}</span>
                                    ${phone.primary ? '<span class="field-primary">Primary</span>' : ''}
                                </div>
                            `).join('')}
                        </div>
                    `;
                }
                
                // Email addresses
                if (displayData.emails && displayData.emails.length > 0) {
                    html += `
                        <div class="field-group">
                            <h4><i class="fas fa-envelope"></i> Email Addresses</h4>
                            ${displayData.emails.map(email => `
                                <div class="field-item">
                                    <a href="mailto:${email.value}" class="field-value">${email.value}</a>
                                    <span class="field-type">${email.type}</span>
                                    ${email.primary ? '<span class="field-primary">Primary</span>' : ''}
                                </div>
                            `).join('')}
                        </div>
                    `;
                }
                
                // Addresses
                if (displayData.addresses && Array.isArray(displayData.addresses) && displayData.addresses.length > 0) {
                    html += `
                        <div class="field-group">
                            <h4><i class="fas fa-map-marker-alt"></i> Addresses</h4>
                            ${displayData.addresses.map(address => `
                                <div class="field-item address-item">
                                    <div class="address-content">
                                        ${address.street ? `<div class="address-line">${address.street}</div>` : ''}
                                        <div class="address-line">
                                            ${[address.city, address.state, address.postalCode].filter(Boolean).join(', ')}
                                        </div>
                                        ${address.country ? `<div class="address-line">${address.country}</div>` : ''}
                                    </div>
                                    <div class="address-meta">
                                        <span class="field-type">${address.type || 'other'}</span>
                                        ${address.primary ? '<span class="field-primary">Primary</span>' : ''}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    `;
                }
                
                // Notes
                if (displayData.notes && Array.isArray(displayData.notes) && displayData.notes.length > 0) {
                    html += `
                        <div class="field-group">
                            <h4><i class="fas fa-sticky-note"></i> Notes</h4>
                            ${displayData.notes.map(note => `
                                <div class="field-item">
                                    <p class="field-value">${note}</p>
                                </div>
                            `).join('')}
                        </div>
                    `;
                }
                
                return html;
            };

            const fieldsHtml = renderContactFields(displayData);
            
            document.getElementById('display-result').innerHTML = `
                <h3>Display Data:</h3>
                <pre>${JSON.stringify(displayData, null, 2)}</pre>
                
                <h3>Rendered Contact Fields:</h3>
                <div class="contact-display">
                    ${fieldsHtml}
                </div>
                
                <h3>Debug Info:</h3>
                <p><strong>Addresses count:</strong> ${displayData.addresses?.length || 0}</p>
                <p><strong>Notes count:</strong> ${displayData.notes?.length || 0}</p>
                <p><strong>Addresses type:</strong> ${Array.isArray(displayData.addresses) ? 'Array' : typeof displayData.addresses}</p>
                <p><strong>Notes type:</strong> ${Array.isArray(displayData.notes) ? 'Array' : typeof displayData.notes}</p>
            `;
        });
    </script>

    <style>
        .container { max-width: 1000px; margin: 0 auto; padding: 20px; }
        .test-section { margin: 30px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px; }
        button { padding: 10px 20px; margin: 10px 0; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
        pre { background: #f8f9fa; padding: 15px; border-radius: 4px; overflow-x: auto; font-size: 12px; }
        .contact-display { border: 1px solid #eee; padding: 15px; margin: 10px 0; }
        .field-group { margin: 15px 0; }
        .field-group h4 { color: #333; margin-bottom: 10px; }
        .field-item { margin: 8px 0; padding: 8px; background: #f8f9fa; border-radius: 4px; }
        .field-value { font-weight: bold; margin-right: 10px; }
        .field-type { color: #666; font-size: 0.9em; margin-right: 10px; }
        .field-primary { background: #28a745; color: white; font-size: 0.8em; padding: 2px 6px; border-radius: 3px; }
        .address-item { display: flex; justify-content: space-between; align-items: flex-start; }
        .address-content { flex: 1; }
        .address-line { margin: 2px 0; }
        .address-meta { display: flex; flex-direction: column; align-items: flex-end; gap: 5px; }
    </style>
</body>
</html>